// app/assets/javascripts/serviceworker.js.erb
console.log('[Service Worker] Hello world!');

function onInstall(event) {
  console.log('[Serviceworker]', "Installing", event);
  event.waitUntil(
      caches.open('cached-assets-v3').then(function prefill(cache) {
        return cache.addAll([
          "/assets/application-d7f56f9c9477158e29697cec3f9077c9a86241a819842637398f70ddab2ddb6b.js",
          "/assets/application.debug-f9d253ca22fcb78d033de5eb06a61c9ea337ac47048ff4dc80f1ce7a9fdfd225.css",
          "//fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900",
          "//fonts.googleapis.com/icon?family=Material+Icons",
          "//cdn.rawgit.com/HubSpot/tether/v1.3.4/dist/js/tether.min.js",
          "//cdn.rawgit.com/FezVrasta/bootstrap-material-design/dist/dist/bootstrap-material-design.iife.min.js"
          // you get the idea ...
        ]);
      })
  );
}

function onActivate(event) {
  console.log('[Serviceworker]', "Activating!", event);
  event.waitUntil(
      caches.keys().then(function(cacheNames) {
        return Promise.all(
            cacheNames.filter(function(cacheName) {
              // Return true if you want to remove this cache,
              // but remember that caches are shared across
              // the whole origin
              return cacheName.indexOf('v1') !== 0;
            }).map(function(cacheName) {
              return caches.delete(cacheName);
            })
        );
      })
  );
}

self.addEventListener('install', onInstall)
self.addEventListener('activate', onActivate)